doctype html
html(lang="en")
  head
    meta(charset="UTF-8")
    meta(name="viewport", content="width=device-width, initial-scale=1")
    title Stock Table
    link(rel="stylesheet", href="/css/stocklist.css")

  body
    // ===== Navbar =====
    nav.navbar
      ul
        li
          a(href="/dashboard") Dashboard 
        li
          a(href="/signup") Register users
        li
          a(href="/userlist") Registered users 
        li
          a(href="/stock") Stock
        li
          a(href="/stocklist") Stocklist
        li
          a(href="/sales") Sales 
        li
          a(href="/saleslist") Saleslist
        li
          a(href="/delivery") Delivery
        li
          a(href="/deliverylist") Deliverylist

    .container
      h1 Stock List

      .action-buttons(style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;")
        a(href="/stock", class="btn btn-black")  Add More Stock
        button#generateAllReport.btn.btn-report(onclick="generateFullReport()")  Generate Full Report

      // ===== SEARCH BAR =====
      .search-container
        input#searchInput.search-input(
          type="text", 
          placeholder="üîç Search",
          onkeyup="searchStock()"
        )
        span#searchResults

      table#stockTable
        thead
          tr
            th Product Name
            th Type
            th Total Qty
            th Quality
            th Cost (shs)
            th Selling (shs)
            th Supplier
            th Total Value
            th Date
            th Actions

        tbody
          - var grandTotal = 0
          if items && items.length
            each item in items
              - var totalQuantity = Number(item.totalQuantity) || 0
              - var available = Number(item.availableQuantity) || 0
              - var cost = Number(item.costPrice) || 0
              - var selling = Number(item.sellingPrice) || 0
              - var totalValue = available * cost
              - grandTotal += totalValue
              tr
                td #{item.productName || '-'}
                td #{item.productType || '-'}
                td #{totalQuantity}
                td #{item.quality || '-'}
                td #{cost.toFixed(2)}
                td #{selling.toFixed(2)}
                td #{item.supplierName || '-'}
                td #{totalValue.toFixed(2)}
                td #{item.date ? moment(item.date).format("DD-MM-YYYY") : '-'}
                td.action-cell
                  a.btn.btn-warning(href=`/editstock/${item._id}`, title="Edit") ‚úèÔ∏è
                  form(method='post', action=`/deletestock/${item._id}`, style="display:inline;")
                    button.btn.btn-danger(type='submit', title="Delete") üóëÔ∏è
                  button.btn.btn-info(onclick=`generateItemReport('${item._id}', '${item.productName}')`, title="Generate Report") üìÑ
          else
            tr
              td(colspan="10", style="text-align:center; color: gray; padding: 30px;") No stock available

        tfoot
          tr(style="background-color: #000; color: #fff; font-weight: bold;")
            td(colspan="7", style="text-align: right; padding-right: 15px;") GRAND TOTAL:
            td #{grandTotal.toFixed(2)}
            td(colspan="2")

      // ===== STOCK OVERVIEW SECTION =====
      h1(style="margin-top: 60px; display: flex; align-items: center; justify-content: space-between;")
        span 
          | Stock Overview 
          span(style="font-size: 14px; font-weight: normal; color: #666; margin-left: 10px;") (Live Data)

      .action-buttons(style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;")
        div(style="font-size: 14px; color: #666;")
        div
          button.btn.btn-black(onclick="refreshStockOverview()", style="margin-right: 10px;")  Refresh
          button#generateOverviewReport.btn.btn-report(onclick="generateOverviewReport()")  Generate Report

      table#overviewTable
        thead
          tr
            th Product Name
            th Type
            th Total Quantity
            th Stock Level
        tbody
          tr
            td(colspan="4", style="text-align:center; color: gray; padding: 30px;") Loading overview data...

    // ===== External JavaScript Files =====
    script(src="/js/stocklist.js")
    script(src="/js/stocklist-reports.js")
    script(src="/js/stockoverview.js")
