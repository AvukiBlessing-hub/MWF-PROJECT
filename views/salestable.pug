doctype html
html(lang="en")
  head
    meta(charset="UTF-8")
    meta(name="viewport", content="width=device-width, initial-scale=1")
    title Sales Table
    link(rel="stylesheet", href="/css/salestable.css")

  body
    // ===== Navbar =====
    nav.navbar
      ul
        li: a(href="/dashboard") Dashboard
        li: a(href="/signup") Register users
        li: a(href="/userlist") Registered users
        li: a(href="/stock") Stock
        li: a(href="/stocklist") Stocklist
        li: a(href="/sales") Sales
        li: a(href="/saleslist") Saleslist
        li: a(href="/delivery") Delivery
        li: a(href="/deliverylist") Deliverylist

    .container
      h1 Sales Table

      .action-buttons
        a.btn.btn-black(href="/sales") Add More Sales
        button#generateAllReport.btn.btn-report(onclick="generateFullSalesReport()") Generate Full Report

      // ===== Search Bar =====
      .search-container
        input#searchInput(
          type="text"
          placeholder="Search by customer, product, type, quality, or agent..."
          onkeyup="filterSalesTable()"
        )
        span.search-icon üîç

      table#salesTable
        thead
          tr
            th Customer
            th Product Type
            th Product
            th Qty
            th Quality
            th Cost (shs)
            th Transport
            th Agent
            th Total (shs)
            if currentUser && (currentUser.role === 'Manager' || currentUser.role === 'Attendant')
              th Actions

        tbody
          - var totalQuantity = 0
          - var totalCostPrice = 0
          - var totalTotalPrice = 0

          if items && items.length
            each item in items
              - totalQuantity += item.quantity || 0
              - totalCostPrice += item.costPrice || 0
              - totalTotalPrice += item.totalPrice || 0
              tr
                td #{item.customerName}
                td #{item.productType}
                td #{item.productName}
                td #{item.quantity}
                td #{item.quality}
                td #{item.costPrice.toFixed(2)}
                td #{item.transportFee ? 'Yes' : 'No'}
                td #{item.Attendant ? (item.Attendant.fullname || item.Attendant.name) : 'N/A'}
                td #{item.totalPrice.toFixed(2)}
                if currentUser && currentUser.role === 'Manager'
                  td.action-cell
                    a.btn.btn-warning(href=`/editsales/${item._id}`, title="Edit") ‚úèÔ∏è
                    form(method='post', action=`/deletesales/${item._id}`, style="display:inline;")
                      button.btn.btn-danger(type='submit', title="Delete") üóëÔ∏è
                    button.btn.btn-info(onclick=`generateSaleReport('${item._id}', '${item.customerName}')`, title="Generate Report") üìÑ
                if currentUser && currentUser.role === 'Attendant'
                  td.action-cell
                    a.btn.btn-receipt(href=`/salesreceipt/${item._id}`, title="Receipt") üßæ
                    button.btn.btn-info(onclick=`generateSaleReport('${item._id}', '${item.customerName}')`, title="Generate Report") üìÑ
          else
            tr#noSalesRow
              td(colspan=10, style="text-align:center; color:gray; padding:30px;") No sales available

        tfoot
          tr(style="background-color:#000; color:#fff; font-weight:bold;")
            td(colspan="3", style="text-align:right; padding-right:15px;") TOTALS:
            td#totalQuantity #{totalQuantity}
            td
            td#totalCostPrice #{totalCostPrice.toFixed(2)}
            td
            td
            td#totalTotalPrice #{totalTotalPrice.toFixed(2)}
            if currentUser && (currentUser.role === 'Manager' || currentUser.role === 'Attendant')
              td

      // No results message
      #noResultsMessage(style="display:none; text-align:center; padding:20px; color:#888; font-style:italic;")
        | No sales found matching your search criteria.

    // ===== External JS =====
    script(src="/js/salestable.js")
